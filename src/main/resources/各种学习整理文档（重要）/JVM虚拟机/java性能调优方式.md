# 					java性能调优方式汇总

## 1、jstat命令

Jstat是JDK自带的一个轻量级小工具。全称“[Java ](http://lib.csdn.net/base/java)Virtual Machine statistics monitoring tool”，它位于[Java](http://lib.csdn.net/base/java)的bin目录下，主要利用JVM内建的指令对Java应用程序的资源和性能进行实时的命令行的监控，包括了对Heap size和垃圾回收状况的监控。可见，Jstat是轻量级的、专门针对JVM的工具，非常适用。

jstat工具特别强大，有众多的可选项，详细查看堆内各个部分的使用量，以及加载类的数量。使用时，需加上查看进程的进程id，和所选参数。参考格式如下：

jstat -options 

可以列出当前JVM版本支持的选项，常见的有



- l class (类加载器) 
- l compiler (JIT) 
- l gc (GC堆状态) 
- l gccapacity (各区大小) 
- l gccause (最近一次GC统计和原因) 
- l gcnew (新区统计)
- l gcnewcapacity (新区大小)
- l gcold (老区统计)
- l gcoldcapacity (老区大小)
- l gcpermcapacity (永久区大小)
- l gcutil (GC统计汇总)
- l printcompilation (HotSpot编译统计)



1、jstat –class<pid> : 显示加载class的数量，及所占空间等信息。

| 显示列名 | 具体描述                 |
| -------- | ------------------------ |
| Loaded   | 装载的类的数量           |
| Bytes    | 装载类所占用的字节数     |
| Unloaded | 卸载类的数量             |
| Bytes    | 卸载类的字节数           |
| Time     | 装载和卸载类所花费的时间 |

2、jstat -compiler <pid>显示VM实时编译的数量等信息。

| 显示列名     | 具体描述                           |
| ------------ | ---------------------------------- |
| Compiled     | 编译任务执行数量                   |
| Failed       | 编译任务执行失败数量               |
| Invalid      | 编译任务执行失效数量               |
| Time         | 编译任务消耗时间                   |
| FailedType   | 最后一个编译失败任务的类型         |
| FailedMethod | 最后一个编译失败任务所在的类及方法 |

3、jstat -gc <pid>: 可以显示gc的信息，查看gc的次数，及时间。

| 显示列名 | 具体描述                                              |
| -------- | ----------------------------------------------------- |
| S0C      | 年轻代中第一个survivor（幸存区）的容量 (字节)         |
| S1C      | 年轻代中第二个survivor（幸存区）的容量 (字节)         |
| S0U      | 年轻代中第一个survivor（幸存区）目前已使用空间 (字节) |
| S1U      | 年轻代中第二个survivor（幸存区）目前已使用空间 (字节) |
| EC       | 年轻代中Eden（伊甸园）的容量 (字节)                   |
| EU       | 年轻代中Eden（伊甸园）目前已使用空间 (字节)           |
| OC       | Old代的容量 (字节)                                    |
| OU       | Old代目前已使用空间 (字节)                            |
| PC       | Perm(持久代)的容量 (字节)                             |
| PU       | Perm(持久代)目前已使用空间 (字节)                     |
| YGC      | 从应用程序启动到采样时年轻代中gc次数                  |
| YGCT     | 从应用程序启动到采样时年轻代中gc所用时间(s)           |
| FGC      | 从应用程序启动到采样时old代(全gc)gc次数               |
| FGCT     | 从应用程序启动到采样时old代(全gc)gc所用时间(s)        |
| GCT      | 从应用程序启动到采样时gc用的总时间(s)                 |

4、**jstat -gccapacity :**可以显示，VM内存中三代（young,old,perm）对象的使用和占用大小

| 显示列名 | 具体描述                                      |
| -------- | --------------------------------------------- |
| NGCMN    | 年轻代(young)中初始化(最小)的大小(字节)       |
| NGCMX    | 年轻代(young)的最大容量 (字节)                |
| NGC      | 年轻代(young)中当前的容量 (字节)              |
| S0C      | 年轻代中第一个survivor（幸存区）的容量 (字节) |
| S1C      | 年轻代中第二个survivor（幸存区）的容量 (字节) |
| EC       | 年轻代中Eden（伊甸园）的容量 (字节)           |
| OGCMN    | old代中初始化(最小)的大小 (字节)              |
| OGCMX    | old代的最大容量(字节)                         |
| OGC      | old代当前新生成的容量 (字节)                  |
| OC       | Old代的容量 (字节)                            |
| PGCMN    | perm代中初始化(最小)的大小 (字节)             |
| PGCMX    | perm代的最大容量 (字节)                       |
| PGC      | perm代当前新生成的容量 (字节)                 |
| PC       | Perm(持久代)的容量 (字节)                     |
| YGC      | 从应用程序启动到采样时年轻代中gc次数          |
| FGC      | 从应用程序启动到采样时old代(全gc)gc次数       |

5、jstat -gcutil <pid>:统计gc信息

| 显示列名 | 具体描述                                                 |
| -------- | -------------------------------------------------------- |
| S0       | 年轻代中第一个survivor（幸存区）已使用的占当前容量百分比 |
| S1       | 年轻代中第二个survivor（幸存区）已使用的占当前容量百分比 |
| E        | 年轻代中Eden（伊甸园）已使用的占当前容量百分比           |
| O        | old代已使用的占当前容量百分比                            |
| P        | perm代已使用的占当前容量百分比                           |
| YGC      | 从应用程序启动到采样时年轻代中gc次数                     |
| YGCT     | 从应用程序启动到采样时年轻代中gc所用时间(s)              |
| FGC      | 从应用程序启动到采样时old代(全gc)gc次数                  |
| FGCT     | 从应用程序启动到采样时old代(全gc)gc所用时间(s)           |
| GCT      | 从应用程序启动到采样时gc用的总时间(s)                    |

6、jstat -gcnew <pid>:年轻代对象的信息。

| 显示列名 | 具体描述                                              |
| -------- | ----------------------------------------------------- |
| S0C      | 年轻代中第一个survivor（幸存区）的容量 (字节)         |
| S1C      | 年轻代中第二个survivor（幸存区）的容量 (字节)         |
| S0U      | 年轻代中第一个survivor（幸存区）目前已使用空间 (字节) |
| S1U      | 年轻代中第二个survivor（幸存区）目前已使用空间 (字节) |
| TT       | 持有次数限制                                          |
| MTT      | 最大持有次数限制                                      |
| EC       | 年轻代中Eden（伊甸园）的容量 (字节)                   |
| EU       | 年轻代中Eden（伊甸园）目前已使用空间 (字节)           |
| YGC      | 从应用程序启动到采样时年轻代中gc次数                  |
| YGCT     | 从应用程序启动到采样时年轻代中gc所用时间(s)           |

7、jstat -gcnewcapacity<pid>: 年轻代对象的信息及其占用量。

| 显示列名 | 具体描述                                          |
| -------- | ------------------------------------------------- |
| NGCMN    | 年轻代(young)中初始化(最小)的大小(字节)           |
| NGCMX    | 年轻代(young)的最大容量 (字节)                    |
| NGC      | 年轻代(young)中当前的容量 (字节)                  |
| S0CMX    | 年轻代中第一个survivor（幸存区）的最大容量 (字节) |
| S0C      | 年轻代中第一个survivor（幸存区）的容量 (字节)     |
| S1CMX    | 年轻代中第二个survivor（幸存区）的最大容量 (字节) |
| S1C      | 年轻代中第二个survivor（幸存区）的容量 (字节)     |
| ECMX     | 年轻代中Eden（伊甸园）的最大容量 (字节)           |
| EC       | 年轻代中Eden（伊甸园）的容量 (字节)               |
| YGC      | 从应用程序启动到采样时年轻代中gc次数              |
| FGC      | 从应用程序启动到采样时old代(全gc)gc次数           |

8、jstat -gcold <pid>：old代对象的信息。

| 显示列名 | 具体描述                                       |
| -------- | ---------------------------------------------- |
| PC       | Perm(持久代)的容量 (字节)                      |
| PU       | Perm(持久代)目前已使用空间 (字节)              |
| OC       | Old代的容量 (字节)                             |
| OU       | Old代目前已使用空间 (字节)                     |
| YGC      | 从应用程序启动到采样时年轻代中gc次数           |
| FGC      | 从应用程序启动到采样时old代(全gc)gc次数        |
| FGCT     | 从应用程序启动到采样时old代(全gc)gc所用时间(s) |
| GCT      | 从应用程序启动到采样时gc用的总时间(s)          |

9、stat -gcoldcapacity <pid>: old代对象的信息及其占用量。

| 显示列名 | 具体描述                                       |
| -------- | ---------------------------------------------- |
| OGCMN    | old代中初始化(最小)的大小 (字节)               |
| OGCMX    | old代的最大容量(字节)                          |
| OGC      | old代当前新生成的容量 (字节)                   |
| OC       | Old代的容量 (字节)                             |
| YGC      | 从应用程序启动到采样时年轻代中gc次数           |
| FGC      | 从应用程序启动到采样时old代(全gc)gc次数        |
| FGCT     | 从应用程序启动到采样时old代(全gc)gc所用时间(s) |
| GCT      | 从应用程序启动到采样时gc用的总时间(s)          |

 

10、jstat -gcpermcapacity<pid>: perm对象的信息及其占用量。

| 显示列名 | 具体描述                                       |
| -------- | ---------------------------------------------- |
| PGCMN    | perm代中初始化(最小)的大小 (字节)              |
| PGCMX    | perm代的最大容量 (字节)                        |
| PGC      | perm代当前新生成的容量 (字节)                  |
| PC       | Perm(持久代)的容量 (字节)                      |
| YGC      | 从应用程序启动到采样时年轻代中gc次数           |
| FGC      | 从应用程序启动到采样时old代(全gc)gc次数        |
| FGCT     | 从应用程序启动到采样时old代(全gc)gc所用时间(s) |
| GCT      | 从应用程序启动到采样时gc用的总时间(s)          |

 

11、jstat -printcompilation <pid>：当前VM执行的信息。

| 显示列名 | 具体描述                                                     |
| -------- | ------------------------------------------------------------ |
| Compiled | 编译任务的数目                                               |
| Size     | 方法生成的字节码的大小                                       |
| Type     | 编译类型                                                     |
| Method   | 类名和方法名用来标识编译的方法。类名使用/做为一个命名空间分隔符。方法名是给定类中的方法。上述格式是由-XX:+PrintComplation选项进行设置的 |



## 2、/proc

### cat /proc/loadavg

proc文件系统是一个虚拟的文件系统，不占用磁盘空间，它反映了当前操作系统在内存中的运行情况，查看/proc下的文件可以聊寄到系统的运行状态。查看系统平均负载使用“cat /proc/loadavg”命令，输出结果如下：
0.27 0.36 0.37 4/83 4828/
**前三个数字大家都知道，是1、5、15分钟内的平均进程数（有人认为是系统负荷的百分比，其实不然，有些时候可以看到200甚至更多）。后面两个呢，一个的分子是正在运行的进程数，分母是进程总数；另一个是最近运行的进程ID号。**



### proc/stat

proc/stat节点记录的是系统进程整体的统计信息

## tat数据

```
Gityuan$ adb shell cat /proc/stat
//CPU指标：user，nice, system, idle, iowait, irq, softirq
cpu  130216 19944 162525 1491240 3784 24749 17773 0 0 0
cpu0 40321 11452 49784 403099 2615 6076 6748 0 0 0
cpu1 26585 2425 36639 151166 404 2533 3541 0 0 0
cpu2 22555 2957 31482 152460 330 2236 2473 0 0 0
cpu3 15232 1243 20945 153740 303 1985 3432 0 0 0
cpu4 5903 595 6017 157410 30 10959 605 0 0 0
cpu5 4716 380 3794 157909 23 118 181 0 0 0
cpu6 8001 515 8995 157571 48 571 180 0 0 0
cpu7 6903 377 4869 157885 31 271 613 0 0 0

intr ...
ctxt 22523049
btime 1500827856
processes 23231
procs_running 1
procs_blocked 0
softirq 3552900 843593 733695 19691 93143 468832 12783 257382 610426 0 513355
```

cpu指标 含义
user 用户态时间
nice 用户态时间(低优先级，nice>0)
system 内核态时间
idle 空闲时间
iowait I/O等待时间
irq 硬中断
softirq 软中断
iowait时间是不可靠值，理由如下：

CPU不会等待I/O执行完成，而iowait是等待I/O完成的时间。 当CPU进入idle状态，很可能会调度另一个task执行，所以iowait计算时间偏小；
多核CPU，iowait的计算并非某一个核，因此计算每一个cpu的iowait非常困难；

intr：系统启动以来的所有interrupts的次数情况
ctxt: 系统上下文切换次数
btime：启动时长(单位:秒)，从Epoch(即1970零时)开始到系统启动所经过的时长，每次启动会改变。
此处指为1500827856，转换北京时间为2017/7/24 0:37:36
processes：系统启动后所创建过的进程数量。当短时间该值特别大，系统可能出现异常
procs_running：处于Runnable状态的进程个数
procs_blocked：处于等待I/O完成的进程个数



****

## 3、uptime

名称： uptime
使用权限： 所有使用者
使用方式： uptime [-V]
说明： uptime 提供使用者下面的资讯，不需其他参数：
现在的时间 系统开机运转到现在经过的时间 连线的使用者数量 最近一分钟，五分钟和十五分钟的系统负载
参数： -V 显示版本资讯。
范例： uptime
其结果为：
10:41am up 5 days, 10 min, 1 users, load average: 0.00, 0.00, 1.99